<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simple Calculator</title>
<style>
  :root{
    --bg:#0f1724; /* deep slate */
    --panel:#0b1a2b;
    --accent:#ff9f1c;
    --muted:#9aa6b2;
    --btn:#1f2b3a;
    --btn-press:#384a5f;
    --text:#e6eef6;
    --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#07202e 0%, #0b1a2b 100%);font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  .app{
    max-width:500px;
    margin:24px auto;
    padding:20px;
    border-radius:18px;
    background:linear-gradient(180deg,var(--panel), rgba(10,22,30,0.85));
    box-shadow: 0 10px 30px rgba(2,6,12,0.6);
  }

  .display {
    background: rgba(255,255,255,0.03);
    padding:18px;
    border-radius:12px;
    color:var(--text);
    text-align:right;
    min-height:72px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    gap:6px;
    word-break:break-all;
  }
  .expression{
    color:var(--muted);
    font-size:18px;
    min-height:20px;
  }
  .output{
    font-size:32px;
    font-weight:600;
    letter-spacing:0.5px;
  }

  .pad{
    margin-top:16px;
    display:grid;
    grid-template-columns: repeat(4,1fr);
    gap:12px;
  }
  button.calc-btn{
    background:var(--btn);
    color:var(--text);
    border:0;
    padding:18px;
    border-radius:12px;
    font-size:20px;
    box-shadow: inset 0 -4px 0 rgba(0,0,0,0.12);
    transition:transform .08s ease, background .08s;
    touch-action: manipulation;
  }
  button.calc-btn:active{ transform: translateY(2px); background:var(--btn-press); }
  .wide{ grid-column: span 2; }
  .accent{ background:linear-gradient(90deg,var(--accent), #ff7a2c); color:#051226; font-weight:600; }
  .danger{ background:linear-gradient(90deg,var(--danger), #ff4c4c); color:#fff; }
  .muted{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04); }

  @media (max-width:420px){
    .app{ margin:12px; padding:16px; border-radius:14px;}
    .output{ font-size:28px;}
    button.calc-btn{ padding:14px; font-size:18px; border-radius:10px;}
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Calculator">
    <div class="display" id="display">
      <div class="expression" id="expr"></div>
      <div class="output" id="out">0</div>
    </div>

    <div class="pad" role="group" aria-label="Calculator keypad">
      <button class="calc-btn muted" data-action="clear">C</button>
      <button class="calc-btn muted" data-action="plusminus">+/-</button>
      <button class="calc-btn muted" data-action="back">⌫</button>
      <button class="calc-btn muted" data-value="/">÷</button>

      <button class="calc-btn" data-value="7">7</button>
      <button class="calc-btn" data-value="8">8</button>
      <button class="calc-btn" data-value="9">9</button>
      <button class="calc-btn muted" data-value="*">×</button>

      <button class="calc-btn" data-value="4">4</button>
      <button class="calc-btn" data-value="5">5</button>
      <button class="calc-btn" data-value="6">6</button>
      <button class="calc-btn muted" data-value="-">−</button>

      <button class="calc-btn" data-value="1">1</button>
      <button class="calc-btn" data-value="2">2</button>
      <button class="calc-btn" data-value="3">3</button>
      <button class="calc-btn muted" data-value="+">+</button>

      <button class="calc-btn wide" data-value="0">0</button>
      <button class="calc-btn" data-value=".">.</button>
      <button class="calc-btn accent" data-action="equals">=</button>
    </div>
  </div>

<script>
(() => {
  const exprEl = document.getElementById('expr');
  const outEl = document.getElementById('out');
  const buttons = document.querySelectorAll('button.calc-btn');

  let expr = '';     // raw expression string (uses standard JS operators)
  let lastResult = null;

  function sanitizeForEval(s){
    // allow digits, operators, parentheses, dot and spaces only
    // replace unicode × ÷ − with JS-friendly operators
    s = s.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');
    if (!/^[0-9+\-*/().\s%]+$/.test(s)) return null;
    // prevent sequences like "**", "*/", "/*" except "^" isn't allowed anyway.
    if (/(\*\*|\/\/|[^0-9.]\.|\.{2,})/.test(s)) return null;
    return s;
  }

  function evaluateExpression(s){
    const safe = sanitizeForEval(s);
    if (safe === null) return {ok:false};
    try{
      // eslint-disable-next-line no-new-func
      const result = Function('"use strict";return (' + safe + ')')();
      if (typeof result === 'number' && isFinite(result)) {
        return {ok:true, value: result};
      }
      return {ok:false};
    }catch(e){
      return {ok:false};
    }
  }

  function render(){
    exprEl.textContent = expr || '';
    if (!expr){
      outEl.textContent = '0';
      return;
    }
    const evalRes = evaluateExpression(expr);
    if (evalRes.ok) {
      let display = evalRes.value;
      // Format large/small numbers
      if (Math.abs(display) >= 1e12 || (Math.abs(display) > 0 && Math.abs(display) < 1e-6)) {
        display = display.toExponential(6);
      } else {
        // trim trailing zeros
        display = parseFloat(display.toFixed(10)).toString();
      }
      outEl.textContent = display;
      lastResult = evalRes.value;
    } else {
      outEl.textContent = '';
    }
  }

  function pressDigit(d){
    // avoid leading zeros
    if (d === '.' && expr.slice(-1) === '.') return;
    expr += d;
    render();
  }

  function pressOperator(op){
    if (!expr && op === '-') { expr = '-'; render(); return; } // allow negative start
    // avoid consecutive operators
    if (/[\+\-\*\/\.]$/.test(expr)) {
      // replace last operator (except '.' handling)
      expr = expr.replace(/[\+\-\*\/]+$/, op);
    } else {
      expr += op;
    }
    render();
  }

  function backspace(){
    expr = expr.slice(0, -1);
    render();
  }

  function clearAll(){
    expr = '';
    lastResult = null;
    render();
  }

  function togglePlusMinus(){
    // try to toggle sign of last number token
    // find last number
    const m = expr.match(/(-?\d*\.?\d+)$/);
    if (m) {
      const num = m[1];
      const start = m.index;
      const toggled = num.startsWith('-') ? num.slice(1) : '-' + num;
      expr = expr.slice(0, start) + toggled;
    } else if (!expr) {
      expr = '-';
    }
    render();
  }

  function doEquals(){
    const r = evaluateExpression(expr);
    if (r.ok) {
      expr = r.value.toString();
      render();
    } else {
      outEl.textContent = 'Error';
      // keep expression for fix
    }
  }

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const val = btn.getAttribute('data-value');
      const action = btn.getAttribute('data-action');

      if (action === 'clear') { clearAll(); return; }
      if (action === 'back') { backspace(); return; }
      if (action === 'plusminus') { togglePlusMinus(); return; }
      if (action === 'equals') { doEquals(); return; }

      if (val) {
        if (/[0-9]/.test(val)) pressDigit(val);
        else if (val === '.') pressDigit('.');
        else pressOperator(val);
      }
    });
  });

  // Keyboard support (soft keyboard)
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') { doEquals(); e.preventDefault(); return; }
    if (e.key === 'Backspace') { backspace(); return; }
    if (e.key === 'Escape') { clearAll(); return; }
    if (/^[0-9]$/.test(e.key)) pressDigit(e.key);
    if (e.key === '.') pressDigit('.');
    if (e.key === '+'||e.key === '-'||e.key === '*'||e.key === '/') pressOperator(e.key);
  });

  // initial render
  render();
})();
</script>
</body>
</html>